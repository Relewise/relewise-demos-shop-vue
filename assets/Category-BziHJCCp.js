import{d as Y,g as c,y as K,E,a as d,b as v,p as U,k as m,F as q,r as G,G as Z,e as V,l as M,H as ee,I as ae,A as te,f,J as re,K as Q,B as se,m as W,o as i,z as le,i as ie,u as oe,R as ue,x as X}from"./index-7eUIqBpx.js";import{_ as ce}from"./Breadcrumb.vue_vue_type_script_setup_true_lang-Bf1atbWi.js";import{t as ne}from"./tracking.service-CmIdkNM9.js";const de={class:"category-page"},ve={class:"flex gap-3"},pe={key:0,class:"hidden lg:block w-1/5"},ge={key:0,class:"px-3 py-3 bg-white rounded mb-3"},ye={class:"w-full lg:w-4/5"},me={key:0},fe={class:"grid grid-cols-2 bg-white rounded p-3 gap-1 items-end lg:flex lg:gap-4"},he={class:"text-xl lg:text-3xl font-semibold"},Pe={key:0,class:"text-sm lg:text-base whitespace-nowrap"},be={key:0,class:"grid gap-3 grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 mt-3"},_e={class:"py-3 flex justify-center"},xe={key:0,class:"absolute flex flex-col gap-3",style:{top:"110px",right:"-220px"}},Ie=Y({__name:"Category",setup(ke){const S=c(null),F=c(null),n=te(),T=c(void 0),w=c(void 0),o=c(void 0),P=c(""),b=c(),D=c(),h=c(1),r=c({price:[],sort:""}),H=c(!1),_=c();async function O(){const p=n.params.id;if(b.value=Array.isArray(n.params.parent)?n.params.parent[0]:n.params.parent,D.value=Array.isArray(n.params.grand)?n.params.grand[0]:n.params.grand,H.value=!D.value&&(!b.value||f.context.value.allowThirdLevelCategories),p&&!Array.isArray(p)&&p!==P.value){ne.trackProductCategoryView(p),new URLSearchParams(window.location.search).forEach((a,t)=>{if(t==="sort"){r.value.sort=a;return}const g=r.value[t];g&&Array.isArray(g)?g.push(a):r.value[t]=[a]});const x=new re(f.defaultSettings).setSelectedCategoryProperties({displayName:!0}).filters(a=>{a.addProductCategoryIdFilter("ImmediateParentOrItsParent",[p])}).facets(a=>a.addProductCategoryHierarchyFacet("Descendants",[],{displayName:!0})).build(),u=await f.getSearcher().searchProductCategories(x);if(f.assertApiCall(u),u!=null&&u.results&&(T.value=u.results[0],u.facets&&u.facets.items)){_.value=[];const a=u.facets.items[0].nodes;if(D.value){const t=Q(a,D.value);_.value.push({id:t==null?void 0:t.category.categoryId,displayName:t==null?void 0:t.category.displayName})}if(b.value){const t=Q(a,b.value);_.value.push({id:t==null?void 0:t.category.categoryId,displayName:t==null?void 0:t.category.displayName})}_.value.push({id:T.value.categoryId,displayName:T.value.displayName})}P.value=p,C()}}O(),K(n,()=>{n.query.open!=="1"&&O()}),K(E.active,()=>{n.query.open!=="1"&&C()});async function C(){var g,I,A,N,s,y,z,$,j,J;const p=E.active.value.toUpperCase();scrollTo({top:0});let l=!1;if(((A=(I=(g=o.value)==null?void 0:g.facets)==null?void 0:I.items)==null?void 0:A.length)===3){const e=(N=o.value)==null?void 0:N.facets.items[2];l=e&&r.value.price.length===2&&Number(r.value.price[0])!==((s=e.available.value)==null?void 0:s.lowerBoundInclusive)||Number(r.value.price[1])!==((y=e.available.value)==null?void 0:y.upperBoundInclusive)}const x=new se(f.defaultSettings).setSelectedProductProperties(f.selectedProductProperties).setSelectedVariantProperties({allData:!0}).setExplodedVariants(1).setRetailMedia({location:{key:"PRODUCT_LISTING_PAGE",placements:[{key:"TOP"},{key:"RIGHT"}],variation:{key:p}}}).filters(e=>{e.addProductCategoryIdFilter("Ancestor",[P.value])}).facets(e=>{H.value?e.addProductCategoryHierarchyFacet("Descendants",[{breadcrumbPathStartingFromRoot:[{id:P.value}]}],{displayName:!0}):e.addCategoryFacet("ImmediateParent",Array.isArray(r.value.category)&&r.value.category.length>0?r.value.category:null),e.addBrandFacet(Array.isArray(r.value.brand)&&r.value.brand.length>0?r.value.brand:null),e.addSalesPriceRangeFacet("Product",l?Number(r.value.price[0]):void 0,l?Number(r.value.price[1]):void 0)}).pagination(e=>e.setPageSize(40).setPage(h.value)).sorting(e=>{r.value.sort==="Popular"?e.sortByProductPopularity():r.value.sort==="SalesPriceDesc"?e.sortByProductAttribute("SalesPrice","Descending"):r.value.sort==="SalesPriceAsc"&&e.sortByProductAttribute("SalesPrice","Ascending")}).build(),k={...W.currentRoute.value.query,...r.value};l||delete k.price,await W.push({path:n.path,query:k});const a=await f.getSearcher().searchProducts(x);if(f.assertApiCall(a),a&&a.facets&&a.facets.items){if(H.value&&a.facets.items[0]!==null){for(var t=a.facets.items[0].nodes[0];t.category.categoryId!==P.value;){if(!t.children){t=null;break}t=t.children[0]}t!=null&&(w.value=t.children??void 0)}else w.value=void 0;if(a.facets.items[2]!==null){const e=a.facets.items[2];Object.keys(e.selected??{}).length===0&&"available"in e&&e.available&&"value"in e.available&&(r.value.price=[((z=e.available.value)==null?void 0:z.lowerBoundInclusive.toString())??"",(($=e.available.value)==null?void 0:$.upperBoundInclusive.toString())??""])}}if(S.value=((j=a==null?void 0:a.results)==null?void 0:j.map(e=>({isPromotion:!1,product:e})))??[],F.value=[],(J=a==null?void 0:a.retailMedia)!=null&&J.placements){const e=a.retailMedia.placements.TOP;e&&e!=null&&e.results&&(S.value=e.results.map(L=>{var R;return{isPromotion:!0,product:(R=L.promotedProduct)==null?void 0:R.result}}).concat(S.value??[]));const B=a.retailMedia.placements.RIGHT;B&&E.active.value==="largeDesktop"&&B!=null&&B.results&&(F.value=B.results.map(L=>{var R;return{isPromotion:!0,product:(R=L.promotedProduct)==null?void 0:R.result}}))}o.value=a}return(p,l)=>{var x,k,u,a,t,g,I,A,N;return i(),d(q,null,[v("div",de,[_.value?(i(),U(ce,{key:0,breadcrumb:_.value},null,8,["breadcrumb"])):m("",!0),v("div",ve,[(x=o.value)!=null&&x.facets||(((k=w.value)==null?void 0:k.length)??0)>0?(i(),d("div",pe,[(((u=w.value)==null?void 0:u.length)??0)>0?(i(),d("div",ge,[l[4]||(l[4]=v("div",{class:"font-semibold text-lg mb-2"}," Categories ",-1)),v("ul",null,[(i(!0),d(q,null,G(w.value,(s,y)=>(i(),d("li",{key:y},[M(oe(ue),{to:{name:b.value?"sub-sub-category":"sub-category",params:{grand:b.value,parent:P.value,id:s.category.categoryId}},class:"text-zinc-700 hover:text-brand-500 transitions ease-in-out delay-150 cursor-pointer"},{default:le(()=>[ie(V(s.category.displayName??s.category.categoryId),1)]),_:2},1032,["to"])]))),128))])])):m("",!0),(a=o.value)!=null&&a.facets?(i(),U(Z,{key:1,page:h.value,"onUpdate:page":l[0]||(l[0]=s=>h.value=s),filters:r.value,facets:o.value.facets,"render-category-facet":!H.value,onSearch:C},null,8,["page","filters","facets","render-category-facet"])):m("",!0)])):m("",!0),v("div",ye,[(t=o.value)!=null&&t.results?(i(),d("div",me,[v("div",fe,[v("div",null,[v("h1",he,V((g=T.value)==null?void 0:g.displayName),1),o.value.hits>0?(i(),d("span",Pe," Showing "+V(h.value*40-39)+" - "+V(((I=o.value)==null?void 0:I.hits)<40?(A=o.value)==null?void 0:A.hits:h.value*40)+" of "+V((N=o.value)==null?void 0:N.hits),1)):m("",!0)]),l[5]||(l[5]=v("div",{class:"hidden lg:block lg:flex-grow"},null,-1)),M(ee,{modelValue:r.value.sort,"onUpdate:modelValue":l[1]||(l[1]=s=>r.value.sort=s),onChange:C},null,8,["modelValue"])]),S.value?(i(),d("div",be,[(i(!0),d(q,null,G(S.value,(s,y)=>(i(),U(X,{key:y,product:s.product,"is-promotion":s.isPromotion},null,8,["product","is-promotion"]))),128))])):m("",!0),v("div",_e,[M(ae,{modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=s=>h.value=s),modelModifiers:{sync:!0},total:o.value.hits,"onUpdate:total":l[3]||(l[3]=s=>o.value.hits=s),"page-size":40,onChange:C},null,8,["modelValue","total"])])])):m("",!0)])])]),F.value?(i(),d("div",xe,[(i(!0),d(q,null,G(F.value.slice(0,4),(s,y)=>(i(),U(X,{key:y,product:s.product,"is-promotion":s.isPromotion,class:"w-[200px]"},null,8,["product","is-promotion"]))),128))])):m("",!0)],64)}}});export{Ie as default};
